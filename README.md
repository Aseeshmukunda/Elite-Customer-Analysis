The chosen problem required identifying 'Elite Customers' based on two complex criteria: order frequency and order value relative to the company-wide average. To tackle this, I utilized Common Table Expressions (CTEs), a crucial technique in competitive programming, to break down the logic into manageable steps, enhancing both readability and performance.
First, I defined the Overall_AOV CTE to calculate the single metric needed for comparison: the company-wide average order value across the entire Orders table. This isolated the global aggregate, which is often a key first step in analytical problems.
Next, I created the Customer_Metrics CTE. This involved grouping the Orders table by customer_id to calculate two essential customer-level aggregates: their total order count and their individual average order value. This prepared the data for the final selection phase.
Finally, the main query joined Customer_Metrics with Overall_AOV using a CROSS JOIN (since it's a one-to-one comparison of all customer averages against a single overall average). I applied the WHERE clause with two conditions: order_count >= 2 and the customer's average exceeding the global average. This demonstrates proficiency in using multi-step aggregation and conditional filtering to solve complex ranking and segmentation problems in SQL
